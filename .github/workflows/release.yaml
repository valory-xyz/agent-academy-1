name: Release Flow

on:
    push:
# 
# on:
#   publish:
#     types: [published]
# 
jobs:
  publish-packages:
    name: Push Packages
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        os: [ubuntu-latest]
        python-version: ["3.10"]
    steps:
      - uses: actions/checkout@master
      - uses: actions/setup-python@v3
        with:
          python-version: ${{ matrix.python-versions }}
      - uses: addnab/docker-run-action@v3
        with:
            image: valory/open-autonomy-user:latest
            options: -v ${{ github.workspace }}:/work
            run: |
              echo "Running Pushing Packages"
              cd /work
              export AUTHOR=$(grep 'service' packages/packages.json | awk -F/ '{print $2}' | head -1)
              autonomy init --reset --author $AUTHOR --ipfs --remote
              autonomy push-all


          # publish-packages:
          #   name: Push Packages
          #   runs-on: ubuntu-20.04
          #   strategy:
          #     matrix:
          #       os: [ubuntu-latest]
          #       python-version: ["3.10"]
          #   steps:
          #     - uses: actions/checkout@master
          #     - uses: actions/setup-python@v3
          #       with:
          #         python-version: ${{ matrix.python-versions }}
          #     - name: Install dependencies
          #       run: |
          #         sudo apt-get update --fix-missing
          #         sudo apt-get autoremove
          #         sudo apt-get autoclean
          #         python -m pip install --upgrade pip
          #         pip install open-autonomy[all] --no-cache

          #     - name: Push Packages
          #       run: |
          #         autonomy init --reset --author elcollectooorr --ipfs --remote
          #         autonomy push-all



